<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>営業日報管理アプリ</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .hidden {
      display: none;
    }
    .autocomplete {
      position: relative;
    }
    .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 200px;
      overflow-y: auto;
      background-color: white;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff;
      border-bottom: 1px solid #d4d4d4;
    }
    .autocomplete-items div:hover {
      background-color: #e9e9e9;
    }
    .autocomplete-active {
      background-color: DodgerBlue !important;
      color: #ffffff;
    }
    .loader {
      border: 5px solid #f3f3f3;
      border-radius: 50%;
      border-top: 5px solid #3498db;
      width: 30px;
      height: 30px;
      animation: spin 2s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- ローディング表示 -->
  <div id="loader" class="position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-light" style="z-index: 9999; opacity: 0.7;">
    <div class="loader"></div>
  </div>

  <!-- ログイン画面 -->
  <div id="loginContainer" class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">営業日報管理システム - ログイン</h4>
          </div>
          <div class="card-body">
            <form id="loginForm">
              <div class="mb-3">
                <label for="email" class="form-label">社員番号（メールアドレス）</label>
                <input type="email" class="form-control" id="email" required>
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">パスワード</label>
                <input type="password" class="form-control" id="password" required>
              </div>
              <button type="submit" class="btn btn-primary w-100">ログイン</button>
              <div class="mt-3 text-danger" id="loginError"></div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- メイン画面 -->
  <div id="mainContainer" class="container-fluid mt-3 hidden">
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">営業日報管理システム</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="navbar-text ms-2">
              <span id="userRole" class="badge bg-light text-dark"></span>
            </li>
          </ul>
          <div class="d-flex">
            <span class="navbar-text me-3">
              <span id="userName" class="text-white"></span>
            </span>
            <button id="logoutBtn" class="btn btn-sm btn-light">ログアウト</button>
          </div>
        </div>
      </div>
    </nav>

    <div class="row">
      <!-- 日報一覧 -->
      <div class="col-md-4 mb-4">
        <div class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">日報一覧</h5>
            <div>
              <button id="createReportBtn" class="btn btn-sm btn-success">
                <i class="fas fa-plus"></i> 新規作成
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <div class="input-group">
                <input type="text" id="searchInput" class="form-control" placeholder="検索...">
                <button id="searchBtn" class="btn btn-outline-secondary">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
            <div id="reportsListContainer" class="list-group overflow-auto" style="max-height: 600px;">
              <!-- 日報リストがここに表示される -->
            </div>
          </div>
        </div>
      </div>

      <!-- 日報詳細 -->
      <div class="col-md-8 mb-4">
        <div id="reportDetailContainer" class="card h-100">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">日報詳細</h5>
            <div>
              <button id="editReportBtn" class="btn btn-sm btn-primary me-2 hidden">
                <i class="fas fa-edit"></i> 編集
              </button>
              <button id="saveReportBtn" class="btn btn-sm btn-success me-2 hidden">
                <i class="fas fa-save"></i> 保存
              </button>
              <button id="cancelEditBtn" class="btn btn-sm btn-secondary hidden">
                <i class="fas fa-times"></i> キャンセル
              </button>
            </div>
          </div>
          <div class="card-body">
            <!-- 新規作成/編集フォーム -->
            <form id="reportForm" class="hidden">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label for="reportDate" class="form-label">日付</label>
                  <input type="date" class="form-control" id="reportDate" required>
                </div>
                <div class="col-md-6 autocomplete">
                  <label for="clientName" class="form-label">訪問先</label>
                  <input type="text" class="form-control" id="clientName" required>
                  <div id="clientSuggestions" class="autocomplete-items"></div>
                </div>
              </div>
              <div class="mb-3">
                <label for="purpose" class="form-label">訪問目的</label>
                <select class="form-control" id="purpose" required>
                  <option value="">選択してください</option>
                  <option value="新規商談">新規商談</option>
                  <option value="商談継続">商談継続</option>
                  <option value="クロージング">クロージング</option>
                  <option value="アフターフォロー">アフターフォロー</option>
                  <option value="その他">その他</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="reportContent" class="form-label">商談内容</label>
                <textarea class="form-control" id="reportContent" rows="5" required></textarea>
              </div>
              <div class="mb-3">
                <label for="result" class="form-label">成果・結果</label>
                <textarea class="form-control" id="result" rows="3" required></textarea>
              </div>
              <div class="mb-3">
                <label for="nextAction" class="form-label">次回アクション</label>
                <textarea class="form-control" id="nextAction" rows="2" required></textarea>
              </div>
            </form>

            <!-- 日報詳細表示 -->
            <div id="reportDetail" class="hidden">
              <div class="row mb-3">
                <div class="col-md-6">
                  <p><strong>日付：</strong> <span id="detailDate"></span></p>
                </div>
                <div class="col-md-6">
                  <p><strong>訪問先：</strong> <span id="detailClient"></span></p>
                </div>
              </div>
              <div class="mb-3">
                <p><strong>訪問目的：</strong> <span id="detailPurpose"></span></p>
              </div>
              <div class="mb-3">
                <p><strong>商談内容：</strong></p>
                <div id="detailContent" class="border p-2 rounded bg-light"></div>
              </div>
              <div class="mb-3">
                <p><strong>成果・結果：</strong></p>
                <div id="detailResult" class="border p-2 rounded bg-light"></div>
              </div>
              <div class="mb-3">
                <p><strong>次回アクション：</strong></p>
                <div id="detailNextAction" class="border p-2 rounded bg-light"></div>
              </div>
              <div class="mb-3">
                <p><strong>作成者：</strong> <span id="detailAuthor"></span></p>
                <p><strong>最終更新：</strong> <span id="detailUpdated"></span></p>
              </div>
            </div>

            <!-- コメントセクション -->
            <div id="commentsSection" class="mt-4 hidden">
              <h5 class="border-bottom pb-2">コメント</h5>
              <div id="commentsList" class="mb-3">
                <!-- コメントがここに表示される -->
              </div>
              <form id="commentForm">
                <div class="mb-3">
                  <textarea class="form-control" id="newComment" rows="2" placeholder="コメントを入力..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">コメント送信</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FirebaseとBootstrapのスクリプト -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-app-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.0/firebase-firestore-compat.js"></script>

  <!-- アプリのメインスクリプト -->
  <script>
    // Firebase設定
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Firebaseの初期化
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // 要素の取得
    const loader = document.getElementById('loader');
    const loginContainer = document.getElementById('loginContainer');
    const mainContainer = document.getElementById('mainContainer');
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');
    const userName = document.getElementById('userName');
    const userRole = document.getElementById('userRole');
    const logoutBtn = document.getElementById('logoutBtn');
    const reportsListContainer = document.getElementById('reportsListContainer');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const createReportBtn = document.getElementById('createReportBtn');
    const reportDetailContainer = document.getElementById('reportDetailContainer');
    const reportDetail = document.getElementById('reportDetail');
    const reportForm = document.getElementById('reportForm');
    const editReportBtn = document.getElementById('editReportBtn');
    const saveReportBtn = document.getElementById('saveReportBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const commentsSection = document.getElementById('commentsSection');
    const commentsList = document.getElementById('commentsList');
    const commentForm = document.getElementById('commentForm');

    // グローバル変数
    let currentUser = null;
    let isAdmin = false;
    let allReports = [];
    let currentReportId = null;
    let allClients = [];
    let editMode = false;

    // 初期化関数
    function init() {
      // 認証状態の監視
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          currentUser = user;
          await loadUserData();
          showMainContainer();
          loadReports();
          loadClients();
        } else {
          showLoginContainer();
        }
        hideLoader();
      });
      
      // 入力フィールド以外をクリックしたときに候補を非表示
      document.addEventListener('click', (e) => {
        if (!input.contains(e.target) && !suggestionsContainer.contains(e.target)) {
          suggestionsContainer.innerHTML = '';
        }
      });
    }

    // ユーティリティ関数
    function showLoginContainer() {
      loginContainer.classList.remove('hidden');
      mainContainer.classList.add('hidden');
    }

    function showMainContainer() {
      loginContainer.classList.add('hidden');
      mainContainer.classList.remove('hidden');
    }

    function showLoader() {
      loader.classList.remove('hidden');
    }

    function hideLoader() {
      loader.classList.add('hidden');
    }

    // アプリ初期化
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>

      // イベントリスナーの登録
      loginForm.addEventListener('submit', handleLogin);
      logoutBtn.addEventListener('click', handleLogout);
      searchBtn.addEventListener('click', handleSearch);
      searchInput.addEventListener('input', handleSearch);
      createReportBtn.addEventListener('click', handleCreateReport);
      editReportBtn.addEventListener('click', handleEditReport);
      saveReportBtn.addEventListener('click', handleSaveReport);
      cancelEditBtn.addEventListener('click', handleCancelEdit);
      commentForm.addEventListener('submit', handleAddComment);

      // クライアント名の自動補完
      const clientNameInput = document.getElementById('clientName');
      clientNameInput.addEventListener('input', handleClientAutocomplete);

      // 日付の初期設定
      document.getElementById('reportDate').valueAsDate = new Date();
    }

    // ユーザーデータ読み込み
    async function loadUserData() {
      try {
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.exists) {
          const userData = userDoc.data();
          userName.textContent = userData.name || currentUser.email;
          isAdmin = userData.role === 'admin';
          userRole.textContent = isAdmin ? '管理者' : '営業担当';
        } else {
          userName.textContent = currentUser.email;
          userRole.textContent = '営業担当';
        }
      } catch (error) {
        console.error('ユーザーデータの読み込みエラー:', error);
      }
    }

    // 日報データ読み込み
    async function loadReports() {
      try {
        showLoader();
        let query = db.collection('reports');
        
        if (!isAdmin) {
          // 管理者以外は自分の日報のみ表示
          query = query.where('authorId', '==', currentUser.uid);
        }
        
        // 日付の新しい順にソート
        query = query.orderBy('reportDate', 'desc');
        
        const snapshot = await query.get();
        allReports = [];
        snapshot.forEach(doc => {
          allReports.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        renderReportsList(allReports);
        hideLoader();
      } catch (error) {
        console.error('日報データの読み込みエラー:', error);
        hideLoader();
      }
    }

    // クライアントデータ読み込み
    async function loadClients() {
      try {
        const snapshot = await db.collection('clients').get();
        allClients = [];
        snapshot.forEach(doc => {
          allClients.push(doc.data().name);
        });
      } catch (error) {
        console.error('クライアントデータの読み込みエラー:', error);
      }
    }

    // 日報リスト表示
    function renderReportsList(reports) {
      reportsListContainer.innerHTML = '';
      
      if (reports.length === 0) {
        reportsListContainer.innerHTML = '<div class="text-center p-3">日報がありません</div>';
        return;
      }
      
      reports.forEach(report => {
        const date = new Date(report.reportDate.seconds * 1000);
        const formattedDate = date.toLocaleDateString('ja-JP');
        
        const item = document.createElement('a');
        item.className = 'list-group-item list-group-item-action';
        item.innerHTML = `
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">${report.clientName}</h6>
            <small>${formattedDate}</small>
          </div>
          <p class="mb-1">${report.purpose}</p>
          <small>${report.authorName}</small>
        `;
        
        item.addEventListener('click', () => {
          // アクティブ状態の切り替え
          document.querySelectorAll('.list-group-item').forEach(el => {
            el.classList.remove('active');
          });
          item.classList.add('active');
          
          loadReportDetail(report.id);
        });
        
        reportsListContainer.appendChild(item);
      });
    }

    // 日報詳細の読み込み
    async function loadReportDetail(reportId) {
      try {
        showLoader();
        currentReportId = reportId;
        
        const reportDoc = await db.collection('reports').doc(reportId).get();
        if (!reportDoc.exists) {
          console.error('日報が見つかりません');
          hideLoader();
          return;
        }
        
        const report = {
          id: reportDoc.id,
          ...reportDoc.data()
        };
        
        renderReportDetail(report);
        loadComments(reportId);
        hideLoader();
      } catch (error) {
        console.error('日報詳細の読み込みエラー:', error);
        hideLoader();
      }
    }

    // 日報詳細表示
    function renderReportDetail(report) {
      // フォームを隠して詳細を表示
      reportForm.classList.add('hidden');
      reportDetail.classList.remove('hidden');
      commentsSection.classList.remove('hidden');
      
      // 詳細情報を設定
      const date = new Date(report.reportDate.seconds * 1000);
      document.getElementById('detailDate').textContent = date.toLocaleDateString('ja-JP');
      document.getElementById('detailClient').textContent = report.clientName;
      document.getElementById('detailPurpose').textContent = report.purpose;
      document.getElementById('detailContent').textContent = report.content;
      document.getElementById('detailResult').textContent = report.result;
      document.getElementById('detailNextAction').textContent = report.nextAction;
      document.getElementById('detailAuthor').textContent = report.authorName;
      
      const updated = new Date(report.updatedAt.seconds * 1000);
      document.getElementById('detailUpdated').textContent = updated.toLocaleString('ja-JP');
      
      // 編集ボタンの表示（管理者または自分の日報のみ編集可能）
      if (isAdmin || report.authorId === currentUser.uid) {
        editReportBtn.classList.remove('hidden');
      } else {
        editReportBtn.classList.add('hidden');
      }
      
      saveReportBtn.classList.add('hidden');
      cancelEditBtn.classList.add('hidden');
      
      // 現在の日報データをフォームにも設定（編集用）
      document.getElementById('reportDate').valueAsDate = date;
      document.getElementById('clientName').value = report.clientName;
      document.getElementById('purpose').value = report.purpose;
      document.getElementById('reportContent').value = report.content;
      document.getElementById('result').value = report.result;
      document.getElementById('nextAction').value = report.nextAction;
    }

    // コメント読み込み
    async function loadComments(reportId) {
      try {
        const snapshot = await db.collection('reports').doc(reportId)
          .collection('comments')
          .orderBy('createdAt', 'asc')
          .get();
        
        commentsList.innerHTML = '';
        
        if (snapshot.empty) {
          commentsList.innerHTML = '<div class="text-center text-muted my-3">コメントはありません</div>';
          return;
        }
        
        snapshot.forEach(doc => {
          const comment = doc.data();
          const commentDate = new Date(comment.createdAt.seconds * 1000);
          
          const commentEl = document.createElement('div');
          commentEl.className = 'card mb-2';
          commentEl.innerHTML = `
            <div class="card-body py-2">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="fw-bold">${comment.authorName}</span>
                <small class="text-muted">${commentDate.toLocaleString('ja-JP')}</small>
              </div>
              <p class="mb-0">${comment.text}</p>
            </div>
          `;
          
          commentsList.appendChild(commentEl);
        });
      } catch (error) {
        console.error('コメントの読み込みエラー:', error);
      }
    }

    // ログイン処理
    async function handleLogin(e) {
      e.preventDefault();
      showLoader();
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        await auth.signInWithEmailAndPassword(email, password);
        loginError.textContent = '';
      } catch (error) {
        console.error('ログインエラー:', error);
        loginError.textContent = 'ログインに失敗しました。メールアドレスとパスワードを確認してください。';
        hideLoader();
      }
    }

    // ログアウト処理
    async function handleLogout() {
      try {
        showLoader();
        await auth.signOut();
      } catch (error) {
        console.error('ログアウトエラー:', error);
        hideLoader();
      }
    }

    // 検索処理
    function handleSearch() {
      const searchText = searchInput.value.toLowerCase();
      
      if (!searchText) {
        renderReportsList(allReports);
        return;
      }
      
      const filteredReports = allReports.filter(report => {
        return (
          report.clientName.toLowerCase().includes(searchText) ||
          report.purpose.toLowerCase().includes(searchText) ||
          report.content.toLowerCase().includes(searchText) ||
          report.authorName.toLowerCase().includes(searchText)
        );
      });
      
      renderReportsList(filteredReports);
    }

    // 新規日報作成
    function handleCreateReport() {
      // リセット
      currentReportId = null;
      editMode = true;
      
      // フォームをリセット
      document.getElementById('reportDate').valueAsDate = new Date();
      document.getElementById('clientName').value = '';
      document.getElementById('purpose').value = '';
      document.getElementById('reportContent').value = '';
      document.getElementById('result').value = '';
      document.getElementById('nextAction').value = '';
      
      // UIの表示設定
      reportDetail.classList.add('hidden');
      commentsSection.classList.add('hidden');
      reportForm.classList.remove('hidden');
      editReportBtn.classList.add('hidden');
      saveReportBtn.classList.remove('hidden');
      cancelEditBtn.classList.remove('hidden');
      
      // アクティブな項目を解除
      document.querySelectorAll('.list-group-item').forEach(el => {
        el.classList.remove('active');
      });
    }

    // 日報編集
    function handleEditReport() {
      editMode = true;
      
      // UIの表示設定
      reportDetail.classList.add('hidden');
      commentsSection.classList.add('hidden');
      reportForm.classList.remove('hidden');
      editReportBtn.classList.add('hidden');
      saveReportBtn.classList.remove('hidden');
      cancelEditBtn.classList.remove('hidden');
    }

    // 日報保存
    async function handleSaveReport(e) {
      e.preventDefault();
      
      try {
        showLoader();
        
        const reportDate = document.getElementById('reportDate').valueAsDate;
        const clientName = document.getElementById('clientName').value;
        const purpose = document.getElementById('purpose').value;
        const content = document.getElementById('reportContent').value;
        const result = document.getElementById('result').value;
        const nextAction = document.getElementById('nextAction').value;
        
        // バリデーション
        if (!reportDate || !clientName || !purpose || !content || !result || !nextAction) {
          alert('すべての項目を入力してください');
          hideLoader();
          return;
        }
        
        const reportData = {
          reportDate: firebase.firestore.Timestamp.fromDate(reportDate),
          clientName,
          purpose,
          content,
          result,
          nextAction,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (!currentReportId) {
          // 新規作成
          reportData.authorId = currentUser.uid;
          reportData.authorName = userName.textContent;
          reportData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
          
          const docRef = await db.collection('reports').add(reportData);
          currentReportId = docRef.id;
          
          // クライアント名が新規の場合は保存
          if (!allClients.includes(clientName)) {
            await db.collection('clients').add({
              name: clientName,
              addedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            allClients.push(clientName);
          }
        } else {
          // 更新
          await db.collection('reports').doc(currentReportId).update(reportData);
          
          // クライアント名が新規の場合は保存
          if (!allClients.includes(clientName)) {
            await db.collection('clients').add({
              name: clientName,
              addedAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            allClients.push(clientName);
          }
        }
        
        // 日報一覧を再読み込み
        await loadReports();
        
        // 詳細画面に戻る
        loadReportDetail(currentReportId);
        editMode = false;
        
        hideLoader();
      } catch (error) {
        console.error('日報保存エラー:', error);
        alert('日報の保存に失敗しました');
        hideLoader();
      }
    }

    // 編集キャンセル
    function handleCancelEdit() {
      if (currentReportId) {
        loadReportDetail(currentReportId);
      } else {
        reportForm.classList.add('hidden');
        
        // 新規作成のキャンセル時は一覧のみ表示
        reportDetail.classList.add('hidden');
        commentsSection.classList.add('hidden');
        saveReportBtn.classList.add('hidden');
        cancelEditBtn.classList.add('hidden');
      }
      
      editMode = false;
    }

    // コメント追加
    async function handleAddComment(e) {
      e.preventDefault();
      
      const commentText = document.getElementById('newComment').value.trim();
      if (!commentText || !currentReportId) return;
      
      try {
        showLoader();
        
        const commentData = {
          text: commentText,
          authorId: currentUser.uid,
          authorName: userName.textContent,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await db.collection('reports').doc(currentReportId)
          .collection('comments').add(commentData);
        
        document.getElementById('newComment').value = '';
        loadComments(currentReportId);
        
        hideLoader();
      } catch (error) {
        console.error('コメント追加エラー:', error);
        hideLoader();
      }
    }

    // クライアント自動補完
    function handleClientAutocomplete() {
      const input = document.getElementById('clientName');
      const suggestionsContainer = document.getElementById('clientSuggestions');
      const value = input.value.toLowerCase();
      
      suggestionsContainer.innerHTML = '';
      
      if (!value) {
        return;
      }
      
      // 部分一致する候補を抽出
      const filteredClients = allClients.filter(client => 
        client.toLowerCase().includes(value)
      );
      
      // 候補を表示
      filteredClients.slice(0, 5).forEach(client => {
        const div = document.createElement('div');
        div.innerHTML = client;
        div.addEventListener('click', () => {
          input.value = client;
          suggestionsContainer.innerHTML = '';
        });
        suggestionsContainer.appendChild(div);
      });
